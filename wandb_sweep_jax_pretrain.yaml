# WandB Sweep Configuration for Snake JAX Supervised Pretraining
# This sweep optimizes hyperparameters for pretraining the transformer

program: pretrain_jax.py
method: bayes  # Bayesian optimization for efficient search
metric:
  name: val/accuracy  # Primary metric: validation accuracy
  goal: maximize

# Early stopping based on validation performance
early_terminate:
  type: hyperband
  min_iter: 10  # Run at least 10 epochs
  eta: 2
  s: 3

parameters:
  # Training settings
  epochs:
    value: 30
  
  batch_size:
    value: 256
  
  val_split:
    value: 0.1
  
  # Base learning rate (for Adam or as base for Muon aux)
  # lr:
  #   distribution: log_uniform_values
  #   min: 0.00001
  #   max: 0.001
  
  # Optimizer selection
  optimizer:
    value: muon
  
  # Muon optimizer parameters (only used when optimizer=muon)
  muon_lr:
    distribution: log_uniform_values
    min: 0.0001
    max: 0.002
  
  muon_aux_lr:
    distribution: log_uniform_values
    min: 0.0001
    max: 0.001
  
  muon_momentum:
    distribution: uniform
    min: 0.90
    max: 0.99
  
  max_grad_norm:
    value: 1.0
  
  # Learning rate schedule
  lr_schedule:
    # values: [constant, cosine, linear]
    values: [cosine, linear]
  
  warmup_epochs:
    values: [5, 10]
  
  min_lr:
    distribution: log_uniform_values
    min: 0.0000001
    max: 0.000001
  
  # Network architecture
  d_model:
    values: [64, 128, 256]
  
  num_layers:
    values: [2, 3, 4]
  
  num_heads:
    values: [2, 4, 8]
  
  dropout:
    distribution: uniform
    min: 0.01
    max: 0.2
  
  # CNN encoder options
  cnn_mode:
    # values: [replace, append]
    value: append

  # Not sure if this works. Comment for now and test.
  # cnn_features:
  #   values: [[32, 64], [32, 64, 128]]
  
  # Dataset
  dataset:
    value: snake_pretrain_dataset_mixed.pkl
  
  # Misc settings
  seed:
    values: [42, 69, 420, 1337]
  
  save_dir:
    value: pretrain_models/sweep
  
# Command to run - include boolean flags directly in command
command:
  - ${env}
  - python
  - ${program}
  - --wandb
  - --use-cnn
  - ${args}
