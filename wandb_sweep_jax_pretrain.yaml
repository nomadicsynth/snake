# WandB Sweep Configuration for Snake JAX Supervised Pretraining
# This sweep optimizes hyperparameters for pretraining the transformer

program: pretrain_jax.py
method: bayes  # Bayesian optimization for efficient search
metric:
  name: val/accuracy  # Primary metric: validation accuracy
  goal: maximize

# Early stopping based on validation performance
early_terminate:
  type: hyperband
  min_iter: 10  # Run at least 10 epochs
  eta: 2
  s: 3

parameters:
  # Training settings
  epochs:
    value: 15
  
  batch_size:
    value: 256
  
  val_split:
    value: 0.1
  
  # Base learning rate (for Adam or as base for Muon aux)
  # lr:
  #   distribution: log_uniform_values
  #   min: 0.00001
  #   max: 0.001
  
  # Optimizer selection
  optimizer:
    value: muon
  
  # Muon optimizer parameters (only used when optimizer=muon)
  muon_lr:
    distribution: log_uniform_values
    min: 0.0001
    max: 0.08
  
  muon_aux_lr:
    distribution: log_uniform_values
    min: 0.00001
    max: 0.001
  
  muon_momentum:
    value: 0.95

  muon_decay:
    distribution: log_uniform_values
    min: 0.01
    max: 0.03
  
  max_grad_norm:
    value: 1.0
  
  # Learning rate schedule
  lr_schedule:
    # values: [constant, cosine, linear]
    # values: [cosine, linear]
    value: cosine
  
  warmup_epochs:
    # values: [5, 10]
    value: 5

  # min_lr:
  #   distribution: log_uniform_values
  #   min: 0.0000001
  #   max: 0.000001
  
  # Network architecture
  d_model:
    # values: [64, 128, 256]
    value: 128

  num_layers:
    value: 3

  num_heads:
    value: 4

  dropout:
    # distribution: uniform
    # min: 0.01
    # max: 0.2
    value: 0.03
  
  # CNN encoder options
  cnn_mode:
    # values: [replace, append]
    value: append

  # Not sure if this works. Comment for now and test.
  # cnn_features:
  #   values: [[32, 64], [32, 64, 128]]
  
  # Dataset
  dataset:
    value: snake_pretrain_dataset_mixed_sweep_10000.pkl
  
  # Misc settings
  seed:
    value: 42
  
  save_dir:
    value: pretrain_models/sweep
  
# Command to run - include boolean flags directly in command
command:
  - ${env}
  - python
  - ${program}
  - --wandb
  - --use-cnn
  - ${args}
