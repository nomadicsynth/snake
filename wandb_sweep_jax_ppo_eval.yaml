# WandB Sweep Configuration for Snake JAX PPO with Evaluation
# This sweep optimizes hyperparameters using evaluation metrics

program: train_snake_purejaxrl.py
method: bayes  # Bayesian optimization for efficient search
metric:
  name: eval/mean_return  # Primary metric: mean return on greedy evaluation
  goal: maximize

# Early stopping based on evaluation performance
early_terminate:
  type: hyperband
  min_iter: 50  # Run at least 50 evaluations
  eta: 2
  s: 3

parameters:
  # Environment (fixed for this sweep)
  width:
    value: 10
  height:
    value: 10
  max_steps:
    value: 500
  
  # Training budget
  total_timesteps:
    value: 5000000
  num_envs:
    value: 512
  num_steps:
    value: 128 
  
  # Evaluation settings
  eval_freq:
    value: 20  # Evaluate every 20 updates
  eval_episodes:
    value: 64  # 64 episodes per eval (faster)
  
  # Optimizer selection
  use_muon:
    value: true
  
  # Muon optimizer parameters (only used when use_muon=true)
  muon_lr:
    distribution: log_uniform_values
    min: 0.001
    max: 0.1
  
  aux_adam_lr:
    distribution: log_uniform_values
    min: 0.00001
    max: 0.001
  
  muon_momentum:
    distribution: uniform
    min: 0.90
    max: 0.99
  
  # PPO hyperparameters
  gamma:
    values: [0.99, 0.995, 0.999]
  
  gae_lambda:
    distribution: uniform
    min: 0.90
    max: 0.99
  
  clip_eps:
    values: [0.1, 0.2, 0.3]
  
  ent_coef:
    distribution: log_uniform_values
    min: 0.001
    max: 0.1
  
  vf_coef:
    values: [0.25, 0.5, 1.0]
  
  max_grad_norm:
    value: 1.0
  
  # Network architecture
  # d_model:
  #   values: [32, 64, 128]
  
  # num_layers:
  #   values: [1, 2, 3]
  
  # num_heads:
  #   values: [2, 4, 8]
  
  # dropout:
  #   distribution: uniform
  #   min: 0.0
  #   max: 0.3
  
  # Minibatch settings
  update_epochs:  # Number of epochs per update
    value: 4  # Standard PPO, don't sweep this - it just makes training slower
  
  num_minibatches:
    value: 32  # Reduced from 64 for faster updates
  
  save_freq:
    value: 100

# Command to run - include boolean flags directly in command
command:
  - ${env}
  - python
  - ${program}
  - --wandb
  - --anneal-lr
  - ${args}
